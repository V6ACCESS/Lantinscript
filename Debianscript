MyScriptName='LantinScript'

SSH_Port1='22'
SSH_Port2='225'

SSH_Banner='https://pastebin.com/raw/d7jULvq8'

Dropbear_Port1='550'
Dropbear_Port2='555'

Stunnel_Port1='443'
Stunnel_Port2='444'

OpenVPN_Port1='110'

Privoxy_Port1='8000'
Privoxy_Port2='8080'

OvpnDownload_Port='86'

MyVPS_Time='Asia/Manila'

function InstUpdates(){
 export DEBIAN_FRONTEND=noninteractive
 apt-get update
 apt-get upgrade -y
 
 apt-get remove --purge ufw firewalld -y

 apt-get install nano wget curl zip unzip tar gzip p7zip-full bc rc openssl cron net-tools dnsutils dos2unix screen bzip2 ccrypt -y
 
 apt-get install dropbear stunnel4 privoxy ca-certificates nginx ruby apt-transport-https lsb-release squid screenfetch -y

 apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libpam-runtime libio-pty-perl apt-show-versions python dbus libxml-parser-perl -y
 apt-get install shared-mime-info -y
 
 gem install lolcat

 apt-get autoremove -y
 
 rm -rf /etc/apt/sources.list.d/openvpn*
 echo "deb http://build.openvpn.net/debian/openvpn/stable $(lsb_release -sc) main" > /etc/apt/sources.list.d/openvpn.list
 wget -qO - http://build.openvpn.net/debian/openvpn/stable/pubkey.gpg|apt-key add -
 apt-get update
 apt-get install openvpn -y
}

function InstWebmin(){
 WebminFile='http://prdownloads.sourceforge.net/webadmin/webmin_1.910_all.deb'
 wget -qO webmin.deb "$WebminFile"
 
 dpkg --install webmin.deb
 
 rm -rf webmin.deb
 
 sed -i 's|ssl=1|ssl=0|g' /etc/webmin/miniserv.conf
 
 systemctl restart webmin
}

function InstSSH(){

 rm -f /etc/ssh/sshd_config*
 
 cat <<'MySSHConfig' > /etc/ssh/sshd_config

Port myPORT1
Port myPORT2
AddressFamily inet
ListenAddress 0.0.0.0
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
PermitRootLogin yes
MaxSessions 1024
PubkeyAuthentication yes
PasswordAuthentication yes
PermitEmptyPasswords no
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
ClientAliveInterval 240
ClientAliveCountMax 2
UseDNS no
Banner /etc/banner
AcceptEnv LANG LC_*
Subsystem   sftp  /usr/lib/openssh/sftp-server
MySSHConfig

 sed -i "s|myPORT1|$SSH_Port1|g" /etc/ssh/sshd_config
 sed -i "s|myPORT2|$SSH_Port2|g" /etc/ssh/sshd_config

 rm -f /etc/banner
 wget -qO /etc/banner "$SSH_Banner"
 dos2unix -q /etc/banner

 sed -i '/password\s*requisite\s*pam_cracklib.s.*/d' /etc/pam.d/common-password
 sed -i 's/use_authtok //g' /etc/pam.d/common-password

 sed -i '/\/bin\/false/d' /etc/shells
 sed -i '/\/usr\/sbin\/nologin/d' /etc/shells
 echo '/bin/false' >> /etc/shells
 echo '/usr/sbin/nologin' >> /etc/shells
 
 systemctl restart ssh
 
 rm -rf /etc/default/dropbear*
 
 cat <<'MyDropbear' > /etc/default/dropbear

NO_START=0
DROPBEAR_PORT=PORT01
DROPBEAR_EXTRA_ARGS="-p PORT02"
DROPBEAR_BANNER="/etc/banner"
DROPBEAR_RSAKEY="/etc/dropbear/dropbear_rsa_host_key"
DROPBEAR_DSSKEY="/etc/dropbear/dropbear_dss_host_key"
DROPBEAR_ECDSAKEY="/etc/dropbear/dropbear_ecdsa_host_key"
DROPBEAR_RECEIVE_WINDOW=65536
MyDropbear

 sed -i "s|PORT01|$Dropbear_Port1|g" /etc/default/dropbear
 sed -i "s|PORT02|$Dropbear_Port2|g" /etc/default/dropbear
 
 systemctl restart dropbear
}

function InsStunnel(){
 StunnelDir=$(ls /etc/default | grep stunnel | head -n1)

cat <<'MyStunnelD' > /etc/default/$StunnelDir

ENABLED=1
FILES="/etc/stunnel/*.conf"
OPTIONS=""
BANNER="/etc/banner"
PPP_RESTART=0
RLIMITS="-n 4096 -d unlimited"
RLIMITS=""
MyStunnelD

 rm -rf /etc/stunnel/*
 
 openssl req -new -x509 -days 9999 -nodes -subj "/C=PH/ST=NCR/L=Manila/O=$MyScriptName/OU=$MyScriptName/CN=$MyScriptName" -out /etc/stunnel/stunnel.pem -keyout /etc/stunnel/stunnel.pem &> /dev/null
 > /dev/null 2>&1

 cat <<'MyStunnelC' > /etc/stunnel/stunnel.conf

pid = /var/run/stunnel.pid
cert = /etc/stunnel/stunnel.pem
client = no
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
TIMEOUTclose = 0

[dropbear]
accept = Stunnel_Port1
connect = 127.0.0.1:dropbear_port_c

[openssh]
accept = Stunnel_Port2
connect = 127.0.0.1:openssh_port_c
MyStunnelC

 sed -i "s|Stunnel_Port1|$Stunnel_Port1|g" /etc/stunnel/stunnel.conf
 sed -i "s|dropbear_port_c|$(netstat -tlnp | grep -i dropbear | awk '{print $4}' | cut -d: -f2 | xargs | awk '{print $2}' | head -n1)|g" /etc/stunnel/stunnel.conf
 sed -i "s|Stunnel_Port2|$Stunnel_Port2|g" /etc/stunnel/stunnel.conf
 sed -i "s|openssh_port_c|$(netstat -tlnp | grep -i ssh | awk '{print $4}' | cut -d: -f2 | xargs | awk '{print $2}' | head -n1)|g" /etc/stunnel/stunnel.conf

 systemctl restart $StunnelDir

}

function InsOpenVPN(){

 if [[ ! -e /etc/openvpn ]]; then
  mkdir -p /etc/openvpn
 fi

 rm -rf /etc/openvpn/*

 cat <<'myOpenVPNconf' > /etc/openvpn/server.conf

port MyOvpnPort
dev tun
proto tcp
ca /etc/openvpn/ca.crt
cert /etc/openvpn/server.crt
key /etc/openvpn/server.key
dh /etc/openvpn/dh.pem
duplicate-cn
cipher none
ncp-disable
auth none
comp-lzo
plugin /etc/openvpn/openvpn-auth-pam.so login
verify-client-cert none
username-as-common-name
max-clients 4000
server 10.0.0.0 255.255.0.0
tun-mtu 1500
tun-mtu-extra 32
mssfix 1450
reneg-sec 1
sndbuf 1
rcvbuf 1
push "sndbuf 1"
push "rcvbuf 1"
push "redirect-gateway def1"
push "route-method exe"
push "route-delay 2"
client-to-client
keepalive 5 50
persist-tun
persist-key
persist-remote-ip
status /etc/openvpn/stats.txt
log /etc/openvpn/openvpn.log
verb 2
script-security 2
socket-flags TCP_NODELAY
push "socket-flags TCP_NODELAY"
myOpenVPNconf
 cat <<'EOF7'> /etc/openvpn/ca.crt
-----BEGIN CERTIFICATE-----
MIIEpDCCA4ygAwIBAgIUF4DwNVNg/kTr3N0ZU8TkTQLPJyswDQYJKoZIhvcNAQEL
BQAwgYsxCzAJBgNVBAYTAlVTMRkwFwYDVQQKExBDbG91ZEZsYXJlLCBJbmMuMTQw
MgYDVQQLEytDbG91ZEZsYXJlIE9yaWdpbiBTU0wgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRMwEQYDVQQIEwpDYWxpZm9ybmlh
MB4XDTIyMDUwODAyNTYwMFoXDTM3MDUwNDAyNTYwMFowYjEZMBcGA1UEChMQQ2xv
dWRGbGFyZSwgSW5jLjEdMBsGA1UECxMUQ2xvdWRGbGFyZSBPcmlnaW4gQ0ExJjAk
BgNVBAMTHUNsb3VkRmxhcmUgT3JpZ2luIENlcnRpZmljYXRlMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEAupmSIgdzgBZtRBds+ONJBZ4jXBjxA+MQFyps
s1p17VN0NBretdH+rJwGmiUnS4V7tIuhbEy4TIsJu2kIW5PnnnDIVvcEAoIuYKcl
0gjY1tGC9/qzN5bRGK98WewMXEM7M3QB8iSmstqDwCRk+UIEQGWDI19erCfwJRSa
HEabU1tZZyJAA8JfurkhEGYPbk+dt0pCchH3x//K9P5Y6GZrnjtkUgyV256+saU1
JxnElVGgm83+v95aE/XKPFvrnGbONqD5Hz9YUD0SvQSlQYNn97rtZ3ue1eo1BzhO
yOLSRxZ5gzMQm66orfi3GqXpYjg5VGbvw1AGa8Fssnq8F/iu6QIDAQABo4IBJjCC
ASIwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcD
ATAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBSUpjBk43RlCSfegovSwozZfxIfbTAf
BgNVHSMEGDAWgBQk6FNXXXw0QIep65TbuuEWePwppDBABggrBgEFBQcBAQQ0MDIw
MAYIKwYBBQUHMAGGJGh0dHA6Ly9vY3NwLmNsb3VkZmxhcmUuY29tL29yaWdpbl9j
YTAnBgNVHREEIDAegg4qLmVsY2F2bGF3LmNvbYIMZWxjYXZsYXcuY29tMDgGA1Ud
HwQxMC8wLaAroCmGJ2h0dHA6Ly9jcmwuY2xvdWRmbGFyZS5jb20vb3JpZ2luX2Nh
LmNybDANBgkqhkiG9w0BAQsFAAOCAQEAbA4fOCyrreruSBMi0NcIsEg4cSPmDvGx
6ksBY0CTdV7f73lpmVV3l9yXWVpg4NmWt62xrmWFqY/9HDVHLUazYIgB6xKrA+DY
fLaVpvK2GOhk6DxB6GaCQEFz7sZo3IwUbJItCD4jP9kwvXAk01U8lHP9qGIYXuqj
rGm7f2X6MeKkexW8/NtOj6Vpu9iGUZ6amlijV1oRYKdxVDQq3074br+D9lVzzMrC
NPTnaPQzt7dSNaZZ0bW9smHJWEZCQLM18DWKp6cej0zxLliLGE6sbG3iMTgOtiV/
5/6f8E7MgOI4HfYvvbLKLB53qZ42qcljpz5/l6BrCLf6MT76YnX/Pw==
-----END CERTIFICATE-----

-----BEGIN PRIVATE KEY-----
MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQC6mZIiB3OAFm1E
F2z440kFniNcGPED4xAXKmyzWnXtU3Q0Gt610f6snAaaJSdLhXu0i6FsTLhMiwm7
aQhbk+eecMhW9wQCgi5gpyXSCNjW0YL3+rM3ltEYr3xZ7AxcQzszdAHyJKay2oPA
JGT5QgRAZYMjX16sJ/AlFJocRptTW1lnIkADwl+6uSEQZg9uT523SkJyEffH/8r0
/ljoZmueO2RSDJXbnr6xpTUnGcSVUaCbzf6/3loT9co8W+ucZs42oPkfP1hQPRK9
BKVBg2f3uu1ne57V6jUHOE7I4tJHFnmDMxCbrqit+LcapeliODlUZu/DUAZrwWyy
erwX+K7pAgMBAAECggEADUljFOY37K5sIFWUrlIswGgmt2eVPcQcwLGGJO0ziW8Q
Tqd9JTArNKo1dCNiHWgHS29H0rjRxK1/x2bur+qjqu337e1PzUfsungcYsy7d+xa
KYMh4Lrt75aLQbHjnWwyGnNPsii27/RMPlG5GOCBAf7YbBvd119Oo61IXewPIku2
4KfsU6gbNDPnQqehcy6HOZmMvMI1TqKUvf/BFBpEyPYZYV2K1tltSgrBK2W0elmx
62bLEhBt8zeMXw2GTBhhKd0mlA8Y/v9P2tOBBEuFgj9fVZbm0hFu5cHqxYnsU4r9
+d13efUQxAbQHXPMaqMHobKh3h4FLlzgy95qdyywcwKBgQD+iPKVSjPIXK6Mjw39
wyMD64R2ZOADtDJ+PyRaIft/GN0ah2JxPGPqSBkuORdcVzPtOL9lLydL5bleAmPH
i4vf2V84fUYuew1HuC27HKdG96E6ATGcv4AOKsdLgJ07TkqWc5tBMhkNjF2hmmY8
YNgfrMJ50ctGa3p8OJnGWDxytwKBgQC7rIWv2Yskjsca/TjLKFYiXFa3YVMVr+jf
gkjAYXU3Vg8GiU3i4RnaEIIdB5SkF0QradIJdVAci7BHxFtqqbXcDjAJQTEy7yVE
qVCZyVNLLBqZ+XaPBbI2C+6jeSsElQuMxn8T027H6y5mfGLK9kT1KTuKAheXaWlM
w1LNOwXLXwKBgQDAMgxqagM70bADdqmr6cLw3M/CzlzQrypJZcg/PtW2nMGnnH7a
3izb5OEOpBFdqoMNJwJulvJnPul/cPKC5H4T4wEhmIZ75nKaqxns5a/xyF43fFtH
7tn02JxwCIexFmb/v/+FdRyxvEGfGwUDpmTLVhnq/l0tqU5tqheDS3EpdQKBgQCB
oMl6TAWqy5/FCZC36nWMKEGRSn0L5sQv1ZqQnwBKp3ubZS1R/29OysZEbN8DdDqW
zfHQrKIYBXhOKdeG1hASHg6Z5diouLwCL/zHLGMG8kCxh7iXUzTj1dwQN/o5oQUo
SFawCANlvREAovvN+spomAFS8tz+rUWZSvSfYxw+ewKBgQDACW/TPMN+oqiA59/k
Uwa013L02VfMRpEvM7knztOv2IHoVimPIMY/cVCt9zoM4oT7F8eHa4uFr32ZSamr
FiMY53H41oJ3iOC+qoutXYMJRZH3i0A7IBnOOA/SSIQ2m3jSl+51aS8UkvYOMFcy
6ULgf/11+Il3+Yo3TOQQmFV4Aw==
-----END PRIVATE KEY-----

EOF10

 grep -v '#' /etc/resolv.conf | grep 'nameserver' | grep -E -o '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | while read -r line; do
	echo "push \"dhcp-option DNS $line\"" >> /etc/openvpn/server.conf
done

 sed -i "s|MyOvpnPort|$OpenVPN_Port1|g" /etc/openvpn/server.conf
 
 openssl dhparam -out /etc/openvpn/dh.pem 1024
 
 wget -qO /etc/openvpn/b.zip 'https://raw.githubusercontent.com/Bonveio/BonvScripts/master/openvpn_plugin64'
 unzip -qq /etc/openvpn/b.zip -d /etc/openvpn
 rm -f /etc/openvpn/b.zip
 
 if [[ "$(hostnamectl | grep -i Virtualization | awk '{print $2}' | head -n1)" == 'openvz' ]]; then
 sed -i 's|LimitNPROC|#LimitNPROC|g' /lib/systemd/system/openvpn*
 systemctl daemon-reload
fi

 sed -i '/net.ipv4.ip_forward.*/d' /etc/sysctl.conf
 echo 'net.ipv4.ip_forward=1' > /etc/sysctl.d/20-openvpn.conf
 sysctl --system &> /dev/null

 PUBLIC_INET="$(ip -4 route ls | grep default | grep -Po '(?<=dev )(\S+)' | head -1)"
 IPCIDR='10.200.0.0/16'
 iptables -I FORWARD -s $IPCIDR -j ACCEPT
 iptables -t nat -A POSTROUTING -o $PUBLIC_INET -j MASQUERADE
 iptables -t nat -A POSTROUTING -s $IPCIDR -o $PUBLIC_INET -j MASQUERADE
 
 echo 1 > /proc/sys/net/ipv4/ip_forward
 
 systemctl start openvpn@server
 systemctl enable openvpn@server
 
 wget -qO /etc/openvpn/openvpn.bash "https://raw.githubusercontent.com/Bonveio/BonvScripts/master/openvpn.bash"
 chmod +x /etc/openvpn/openvpn.bash
}

function InsProxy(){

 rm -rf /etc/privoxy/config*
 
 cat <<'myPrivoxy' > /etc/privoxy/config

user-manual /usr/share/doc/privoxy/user-manual
confdir /etc/privoxy
logdir /var/log/privoxy
filterfile default.filter
logfile logfile
listen-address 0.0.0.0:Privoxy_Port1
listen-address 0.0.0.0:Privoxy_Port2
toggle 1
enable-remote-toggle 1
enable-remote-http-toggle 1
enable-edit-actions 1
enforce-blocks 1
buffer-limit 4096
enable-proxy-authentication-forwarding 1
forwarded-connect-retries 1
accept-intercepted-requests 1
allow-cgi-request-crunching 1
split-large-forms 1
keep-alive-timeout 5
tolerate-pipelining 1
socket-timeout 300
permit-access 0.0.0.0/0 IP-ADDRESS
myPrivoxy

 sed -i "s|IP-ADDRESS|$IPADDR|g" /etc/privoxy/config
 
 sed -i "s|Privoxy_Port1|$Privoxy_Port1|g" /etc/privoxy/config
 sed -i "s|Privoxy_Port2|$Privoxy_Port2|g" /etc/privoxy/config

 rm -rf /etc/squid/sq*
 cat <<'mySquid' > /etc/squid/squid.conf
via off
forwarded_for delete
request_header_access Authorization allow all
request_header_access Proxy-Authorization allow all
request_header_access Cache-Control allow all
request_header_access Content-Length allow all
request_header_access Content-Type allow all
request_header_access Date allow all
request_header_access Host allow all
request_header_access If-Modified-Since allow all
request_header_access Pragma allow all
request_header_access Accept allow all
request_header_access Accept-Charset allow all
request_header_access Accept-Encoding allow all
request_header_access Accept-Language allow all
request_header_access Connection allow all
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Referer deny all
request_header_access All deny all
http_access allow localhost
http_access deny all
http_port 127.0.0.1:8989
cache_peer 127.0.0.1 parent SquidCacheHelper 7 no-query no-digest default
cache deny all
mySquid
 sed -i "s|SquidCacheHelper|$Privoxy_Port1|g" /etc/squid/squid.conf

 echo -e "Restarting proxy server.."
 systemctl restart squid
 systemctl restart privoxy
}

function OvpnConfigs(){

 cat <<'myNginxC' > /etc/nginx/conf.d/bonveio-ovpn-config.conf

server {
 listen 0.0.0.0:myNginx;
 server_name localhost;
 root /var/www/openvpn;
 index index.html;
}
myNginxC

 sed -i "s|myNginx|$OvpnDownload_Port|g" /etc/nginx/conf.d/bonveio-ovpn-config.conf

 rm -rf /etc/nginx/sites-*

 rm -rf /var/www/openvpn
 mkdir -p /var/www/openvpn

cat <<EOF15> /var/www/openvpn/GTM-PC-Config.ovpn
client
dev tun
proto tcp
remote $IPADDR $OpenVPN_Port1
remote-cert-tls server
resolv-retry infinite
nobind
tun-mtu 1500
tun-mtu-extra 32
mssfix 1450
persist-key
persist-tun
auth-user-pass
auth none
auth-nocache
cipher none
keysize 0
comp-lzo
setenv CLIENT_CERT 0
reneg-sec 0
verb 1
http-proxy $IPADDR $Privoxy_Port1
http-proxy-option VERSION 1.1
http-proxy-retry
http-proxy-option CUSTOM-HEADER Host www.googletagmanager.com
http-proxy-option CUSTOM-HEADER Host www.googletagmanager.com
http-proxy-option CUSTOM-HEADER Host www.googletagmanager.com
http-proxy-option CUSTOM-HEADER Referrer www.googletagmanager.com

<ca>
$(cat /etc/openvpn/ca.crt)
</ca>
EOF15

cat <<EOF152> /var/www/openvpn/GTMConfig.ovpn
client
dev tun
proto tcp
remote $IPADDR $OpenVPN_Port1
remote-cert-tls server
resolv-retry infinite
nobind
tun-mtu 1500
tun-mtu-extra 32
mssfix 1450
persist-key
persist-tun
auth-user-pass
auth none
auth-nocache
cipher none
keysize 0
comp-lzo
setenv CLIENT_CERT 0
reneg-sec 0
verb 1
http-proxy $IPADDR $Privoxy_Port1
http-proxy-option VERSION 1.1
http-proxy-retry
http-proxy-option CUSTOM-HEADER Host c3cdn.ml.youngjoygame.com
http-proxy-option CUSTOM-HEADER X-Forward-Host c3cdn.ml.youngjoygame.com
http-proxy-option CUSTOM-HEADER X-Forwarded-For c3cdn.ml.youngjoygame.com
http-proxy-option CUSTOM-HEADER Referrer c3cdn.ml.youngjoygame.com

<ca>
$(cat /etc/openvpn/ca.crt)
</ca>
EOF152

cat <<EOF16> /var/www/openvpn/SunConfig.ovpn
client
dev tun
proto tcp
remote $IPADDR $OpenVPN_Port1
remote-cert-tls server
resolv-retry infinite
nobind
tun-mtu 1500
tun-mtu-extra 32
mssfix 1450
persist-key
persist-tun
auth-user-pass
auth none
auth-nocache
cipher none
keysize 0
comp-lzo
setenv CLIENT_CERT 0
reneg-sec 0
verb 1
http-proxy $IPADDR $Privoxy_Port1
http-proxy-retry
http-proxy-option CUSTOM-HEADER Host 0.facebook.com.tiktok.com.instagram.com.kumu.ph
http-proxy-option CUSTOM-HEADER Host 0.facebook.com.tiktok.com.instagram.com.kumu.ph
http-proxy-option CUSTOM-HEADER Host 0.facebook.com.tiktok.com.instagram.com.kumu.ph
http-proxy-option CUSTOM-HEADER Referrer 0.facebook.com.tiktok.com.instagram.com.kumu.ph

<ca>
$(cat /etc/openvpn/ca.crt)
</ca>
EOF16

cat <<EOF17> /var/www/openvpn/SunNoloadConfig.ovpn
client
dev tun
proto tcp-client
remote $IPADDR $OpenVPN_Port1
remote-cert-tls server
bind
float
tun-mtu 1500
tun-mtu-extra 32
mssfix 1450
mute-replay-warnings
connect-retry-max 9999
redirect-gateway def1
connect-retry 0 1
resolv-retry infinite
setenv CLIENT_CERT 0
persist-tun
persist-key
auth-user-pass
auth none
auth-nocache
auth-retry interact
cipher none
keysize 0
comp-lzo
reneg-sec 0
verb 0
nice -20
log /dev/null
<ca>
$(cat /etc/openvpn/ca.crt)
</ca>
EOF17

cat <<'mySiteOvpn' > /var/www/openvpn/index.html
<!DOCTYPE html>
<html lang="en">

<!-- Simple OVPN Download site by Bonveio Abitona -->

<head><meta charset="utf-8" /><title>MyScriptName OVPN Config Download</title><meta name="description" content="MyScriptName Server" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" /><meta name="theme-color" content="#000000" /><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"><link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.3/css/mdb.min.css" rel="stylesheet"></head><body><div class="container justify-content-center" style="margin-top:9em;margin-bottom:5em;"><div class="col-md"><div class="view"><img src="https://openvpn.net/wp-content/uploads/openvpn.jpg" class="card-img-top"><div class="mask rgba-white-slight"></div></div><div class="card"><div class="card-body"><h5 class="card-title">Config List</h5><br /><ul class="list-group"><li class="list-group-item justify-content-between align-items-center" style="margin-bottom:1em;"><p>For Globe/TM <span class="badge light-blue darken-4">Android/iOS</span><br /><small> For EZ/GS Promo with WNP,SNS,FB and IG freebies</small></p><a class="btn btn-outline-success waves-effect btn-sm" href="http://IP-ADDRESS:NGINXPORT/GTMConfig.ovpn" style="float:right;"><i class="fa fa-download"></i> Download</a></li><li class="list-group-item justify-content-between align-items-center" style="margin-bottom:1em;"><p>For Globe/TM <span class="badge light-blue darken-4">PC/Modem</span><br /><small> For EZ/GS Promo with WNP,SNS,FB and IG freebies</small></p><a class="btn btn-outline-success waves-effect btn-sm" href="http://IP-ADDRESS:NGINXPORT/GTM-PC-Config.ovpn" style="float:right;"><i class="fa fa-download"></i> Download</a></li><li class="list-group-item justify-content-between align-items-center" style="margin-bottom:1em;"><p>For Sun <span class="badge light-blue darken-4">Android/iOS/PC/Modem</span><br /><small> For TU Promos</small></p><a class="btn btn-outline-success waves-effect btn-sm" href="http://IP-ADDRESS:NGINXPORT/SunConfig.ovpn" style="float:right;"><i class="fa fa-download"></i> Download</a></li><li class="list-group-item justify-content-between align-items-center" style="margin-bottom:1em;"><p>For Sun <span class="badge light-blue darken-4">Modem</span><br /><small> Without Promo/Noload</small></p><a class="btn btn-outline-success waves-effect btn-sm" href="http://IP-ADDRESS:NGINXPORT/SunNoloadConfig.ovpn" style="float:right;"><i class="fa fa-download"></i> Download</a></li></ul></div></div></div></div></body></html>
mySiteOvpn
 
 # Setting template's correct name,IP address and nginx Port
 sed -i "s|MyScriptName|$MyScriptName|g" /var/www/openvpn/index.html
 sed -i "s|NGINXPORT|$OvpnDownload_Port|g" /var/www/openvpn/index.html
 sed -i "s|IP-ADDRESS|$IPADDR|g" /var/www/openvpn/index.html

 systemctl restart nginx
 
 cd /var/www/openvpn
 zip -qq -r Configs.zip *.ovpn
 cd
}

function ip_address(){
  local IP="$( ip addr | egrep -o '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | egrep -v "^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\." | head -n 1 )"
  [ -z "${IP}" ] && IP="$( wget -qO- -t1 -T2 ipv4.icanhazip.com )"
  [ -z "${IP}" ] && IP="$( wget -qO- -t1 -T2 ipinfo.io/ip )"
  [ ! -z "${IP}" ] && echo "${IP}" || echo
} 
IPADDR="$(ip_address)"

function ConfStartup(){

 echo -e "0 4\t* * *\troot\treboot" > /etc/cron.d/b_reboot_job

 rm -rf /etc/bonveio
 mkdir -p /etc/bonveio
 chmod -R 755 /etc/bonveio
 
 cat <<'EOFSH' > /etc/bonveio/startup.sh

ln -fs /usr/share/zoneinfo/MyVPS_Time /etc/localtime

export DEBIAN_FRONTEND=noninteractive

iptables -A INPUT -s $(wget -4qO- http://ipinfo.io/ip) -p tcp -m multiport --dport 1:65535 -j ACCEPT

/bin/bash /etc/openvpn/openvpn.bash

/usr/local/sbin/delete_expired &> /dev/null
EOFSH
 chmod +x /etc/bonveio/startup.sh
 
 sed -i "s|MyVPS_Time|$MyVPS_Time|g" /etc/bonveio/startup.sh

 rm -rf /etc/sysctl.d/99*

 echo "[Unit]
Description=Bonveio Startup Script
Before=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/bin/bash /etc/bonveio/startup.sh
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target" > /etc/systemd/system/bonveio.service
 chmod +x /etc/systemd/system/bonveio.service
 systemctl daemon-reload
 systemctl start bonveio
 systemctl enable bonveio &> /dev/null

 systemctl restart cron
 systemctl enable cron
 
}

function ConfMenu(){
echo -e " Creating Menu scripts.."

cd /usr/local/sbin/
rm -rf {accounts,base-ports,base-ports-wc,base-script,bench-network,clearcache,connections,create,create_random,create_trial,delete_expired,diagnose,edit_dropbear,edit_openssh,edit_openvpn,edit_ports,edit_squid3,edit_stunnel4,locked_list,menu,options,ram,reboot_sys,reboot_sys_auto,restart_services,server,set_multilogin_autokill,set_multilogin_autokill_lib,show_ports,speedtest,user_delete,user_details,user_details_lib,user_extend,user_list,user_lock,user_unlock}
wget -q 'https://raw.githubusercontent.com/Bonveio/BonvScripts/master/menu.zip'
unzip -qq menu.zip
rm -f menu.zip
chmod +x ./*
dos2unix ./* &> /dev/null
sed -i 's|/etc/squid/squid.conf|/etc/privoxy/config|g' ./*
sed -i 's|http_port|listen-address|g' ./*
cd ~

echo 'clear' > /etc/profile.d/bonv.sh
echo 'echo '' > /var/log/syslog' >> /etc/profile.d/bonv.sh
echo 'screenfetch -p -A Android' >> /etc/profile.d/bonv.sh
chmod +x /etc/profile.d/bonv.sh
}

function ScriptMessage(){
 echo -e " (｡◕‿◕｡) $MyScriptName Debian VPS Installer"
 echo -e " Open release version"
 echo -e ""
 echo -e " Script created by Bonveio"
 echo -e ""
}

 source /etc/os-release
if [[ "$ID" != 'debian' ]]; then
 ScriptMessage
 echo -e "[\e[1;31mError\e[0m] This script is for Debian only, exting..." 
 exit 1
fi

 if [[ $EUID -ne 0 ]];then
 ScriptMessage
 echo -e "[\e[1;31mError\e[0m] This script must be run as root, exiting..."
 exit 1
fi

 if [[ ! -e /dev/net/tun ]]; then
 echo -e "[\e[1;31m×\e[0m] You cant use this script without TUN Module installed/embedded in your machine, file a support ticket to your machine admin about this matter"
 echo -e "[\e[1;31m-\e[0m] Script is now exiting..."
 exit 1
fi

 ScriptMessage
 sleep 2
 InstUpdates
 
 echo -e "Configuring ssh..."
 InstSSH
 
 echo -e "Configuring stunnel..."
 InsStunnel
 
 echo -e "Configuring webmin..."
 InstWebmin
 
 echo -e "Configuring proxy..."
 InsProxy
 
 echo -e "Configuring OpenVPN..."
 InsOpenVPN
 
 OvpnConfigs
 
 ConfStartup
 ConfMenu
 
 ln -fs /usr/share/zoneinfo/$MyVPS_Time /etc/localtime
 
 clear
 cd ~

 bash /etc/profile.d/bonv.sh

 rm -rf /root/.bash_history && history -c && echo '' > /var/log/syslog

rm -f DebianVPS-Installer*
exit 1
